<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Türkiye’den Kıbrıs’a Teslimat</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #003366;
      --secondary: #ffb300;
      --bg: #f7f9fa;
      --white: #fff;
      --gray: #eee;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    body {
      margin: 0;
      background: var(--bg);
      font-family: 'Roboto', Arial, sans-serif;
      color: #222;
    }
    .header {
      width: 100%;
      position: relative;
      overflow: hidden;
      background: var(--gray);
    }
    .header img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      display: block;
      filter: brightness(0.7);
    }
    .header-content {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: var(--white);
      text-shadow: 0 2px 10px rgba(0,0,0,0.7);
      z-index: 2;
      pointer-events: none;
    }
    .header-content h1 {
      font-size: 2.2rem;
      margin: 0 0 8px 0;
      font-weight: 700;
    }
    .header-content h2 {
      font-size: 1.2rem;
      margin: 0;
      font-weight: 400;
    }
    .user-status {
      position: absolute;
      top: 20px;
      right: 30px;
      z-index: 3;
      pointer-events: auto;
    }
    .user-status a, .user-status span {
      background: var(--white);
      color: var(--primary);
      margin-left: 10px;
      padding: 6px 16px;
      border-radius: 20px;
      text-decoration: none;
      font-weight: 500;
      font-size: 1rem;
      box-shadow: var(--shadow);
      transition: background 0.2s;
      cursor: pointer;
      border: none;
      outline: none;
    }
    .user-status a:hover {
      background: var(--secondary);
      color: var(--primary);
    }
    .main-buttons {
      margin: 30px auto 24px auto;
      display: flex;
      justify-content: center;
      gap: 18px;
      flex-wrap: wrap;
      max-width: 800px;
    }
    .main-buttons button {
      background: var(--primary);
      color: var(--white);
      font-size: 1.1rem;
      padding: 16px 30px;
      border: none;
      border-radius: 8px;
      font-weight: 700;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: background 0.2s;
    }
    .main-buttons button:hover {
      background: var(--secondary);
      color: var(--primary);
    }
    .calculator {
      max-width: 440px;
      margin: 32px auto 36px auto;
      background: var(--white);
      border-radius: 13px;
      box-shadow: var(--shadow);
      padding: 26px 22px 26px 22px;
    }
    .calculator h3 {
      text-align: center;
      margin-bottom: 18px;
      color: var(--primary);
      font-size: 1.3rem;
    }
    .form-row {
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
    }
    .form-row label {
      margin-bottom: 4px;
      font-weight: 500;
      font-size: 1rem;
    }
    .form-row input[type="text"], .form-row input[type="number"], .form-row select {
      padding: 8px 10px;
      font-size: 1rem;
      border: 1px solid #bbb;
      border-radius: 5px;
      background: var(--bg);
    }
    .form-row input[type="number"]::-webkit-inner-spin-button,
    .form-row input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .form-row select {
      cursor: pointer;
    }
    .city-row {
      display: none;
      margin-bottom: 15px;
    }
    .result-row {
      text-align: center;
      font-size: 1.15rem;
      font-weight: 700;
      margin: 16px 0;
      color: var(--primary);
    }
    .calc-btn {
      width: 100%;
      font-size: 1.1rem;
      padding: 13px 0;
      background: var(--secondary);
      color: var(--primary);
      border: none;
      border-radius: 7px;
      font-weight: 700;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s;
    }
    .calc-btn:hover {
      background: var(--primary);
      color: var(--white);
    }
    @media (max-width: 700px) {
      .main-buttons { flex-direction: column; gap: 14px;}
      .header img { height: 150px; }
      .calculator { max-width: 99vw; }
    }
  </style>
</head>
<body>
  <div class="header">
    <img src="https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=1280&q=80" alt="Gemi">
    <div class="user-status" id="userStatus"></div>
    <div class="header-content">
      <h1>Türkiye’den Kıbrıs’a Teslimat</h1>
      <h2>Hızlı ve Güvenilir Kargo Hizmeti</h2>
    </div>
  </div>

  <div class="main-buttons">
    <button id="btnSiparisVer">Sipariş Ver</button>
    <button id="btnSiparislerim">Siparişlerim</button>
    <button id="btnKargoTakip">Kargo Takip</button>
  </div>

  <div class="calculator">
    <h3>Kargo Ücreti Hesapla</h3>
    <div class="form-row">
      <label for="urunLink">Ürün Linki</label>
      <input type="text" id="urunLink" placeholder="Ürün linkini girin" required>
    </div>
    <div class="form-row">
      <label for="turkiyeFiyat">Türkiye Fiyatı (₺)</label>
      <input type="number" id="turkiyeFiyat" placeholder="Örn: 1000" min="1" required>
    </div>
    <div class="form-row">
      <label for="kategori">Kategori</label>
      <select id="kategori" required>
        <option value="" disabled selected>Seçiniz</option>
        <option value="mobilya">Mobilya</option>
        <option value="elektronik">Elektronik</option>
        <option value="giyim">Giyim</option>
        <option value="kozmetik">Kozmetik</option>
      </select>
    </div>
    <div class="form-row">
      <label for="teslimatTipi">Teslimat Tipi</label>
      <select id="teslimatTipi" required>
        <option value="" disabled selected>Seçiniz</option>
        <option value="depo">Depo Teslim</option>
        <option value="eve">Eve Teslim</option>
      </select>
    </div>
    <div class="form-row city-row" id="cityRow">
      <label for="sehir">Şehir</label>
      <select id="sehir">
        <option value="" disabled selected>Seçiniz</option>
        <option value="Lefkoşa">Lefkoşa (+200₺)</option>
        <option value="Girne">Girne (+350₺)</option>
        <option value="Güzelyurt">Güzelyurt (+300₺)</option>
        <option value="Lefke">Lefke (+450₺)</option>
        <option value="Mağusa">Mağusa (+500₺)</option>
        <option value="İskele">İskele (+550₺)</option>
        <option value="Karpaz">Karpaz (+650₺)</option>
      </select>
    </div>
    <div class="result-row" id="resultRow" style="display:none"></div>
    <button class="calc-btn" id="calcBtn">Ücreti Hesapla</button>
  </div>

  <script>
    // Kullanıcı durumu
    function updateUserStatus() {
      const userName = localStorage.getItem("userName");
      const userStatus = document.getElementById("userStatus");
      if (userName) {
        userStatus.innerHTML = `<span>${userName}</span>`;
      } else {
        userStatus.innerHTML = `
          <a href="girisyap.html" id="girisYap">Giriş Yap</a>
          <a href="kayitol.html" id="kayitOl">Kayıt Ol</a>
        `;
      }
    }
    updateUserStatus();

    // Giriş kontrolü
    function isLoggedIn() {
      return !!localStorage.getItem("userName");
    }
    function requireLogin(e) {
      if (!isLoggedIn()) {
        alert("Lütfen giriş yapın veya kayıt olun.");
        e.preventDefault();
        return false;
      }
      return true;
    }

    // Ana butonlar
    document.getElementById("btnSiparisVer").onclick = function(e){
      if (isLoggedIn()) {
        window.location.href = "siparisver.html";
      } else {
        alert("Lütfen giriş yapın veya kayıt olun.");
      }
    };
    document.getElementById("btnSiparislerim").onclick = function(e){
      if (isLoggedIn()) {
        window.location.href = "siparislerim.html";
      } else {
        alert("Lütfen giriş yapın veya kayıt olun.");
      }
    };
    document.getElementById("btnKargoTakip").onclick = function(e){
      if (isLoggedIn()) {
        window.location.href = "kargotakip.html";
      } else {
        alert("Lütfen giriş yapın veya kayıt olun.");
      }
    };

    // Teslimat tipi ve şehir
    document.getElementById("teslimatTipi").addEventListener("change", function(){
      const cityRow = document.getElementById("cityRow");
      if (this.value === "eve") {
        cityRow.style.display = "flex";
      } else {
        cityRow.style.display = "none";
        document.getElementById("sehir").value = "";
      }
    });

    // Hesaplama
    const kategoriBedel = {
      mobilya: {type: "flat", value: 70},
      elektronik: {type: "percent", value: 70},
      giyim: {type: "percent", value: 50},
      kozmetik: {type: "percent", value: 70}
    };
    const sehirUcret = {
      "Lefkoşa": 200,
      "Girne": 350,
      "Güzelyurt": 300,
      "Lefke": 450,
      "Mağusa": 500,
      "İskele": 550,
      "Karpaz": 650
    };

    let hesaplamaBilgisi = null;
    let calcBtnState = "hesapla"; // "hesapla" veya "siparisver"

    document.getElementById("calcBtn").onclick = function(e) {
      const urunLink = document.getElementById("urunLink").value.trim();
      const turkiyeFiyat = parseFloat(document.getElementById("turkiyeFiyat").value.trim());
      const kategori = document.getElementById("kategori").value;
      const teslimatTipi = document.getElementById("teslimatTipi").value;
      const sehir = document.getElementById("sehir").value;

      if (calcBtnState === "hesapla") {
        // Alan kontrolü
        if (!urunLink || !turkiyeFiyat || !kategori || !teslimatTipi || (teslimatTipi === "eve" && !sehir)) {
          alert("Lütfen tüm alanları eksiksiz doldurun.");
          return;
        }

        let hizmetBedeli = 0;
        if (kategoriBedel[kategori].type === "flat") {
          hizmetBedeli = kategoriBedel[kategori].value;
        } else {
          hizmetBedeli = turkiyeFiyat * (kategoriBedel[kategori].value/100);
        }

        let toplamUcret = turkiyeFiyat + hizmetBedeli;
        let sehirUcreti = 0;
        if (teslimatTipi === "eve" && sehirUcret[sehir]) {
          sehirUcreti = sehirUcret[sehir];
          toplamUcret += sehirUcreti;
        }

        const toplamUcretStr = toplamUcret.toLocaleString("tr-TR", { style: "currency", currency: "TRY", minimumFractionDigits: 2 });

        hesaplamaBilgisi = {
          urunLink, turkiyeFiyat, kategori, teslimatTipi, sehir: teslimatTipi==="eve"? sehir: null,
          hizmetBedeli: hizmetBedeli,
          sehirUcreti: sehirUcreti,
          toplamUcret: toplamUcret
        };

        document.getElementById("resultRow").innerHTML = `Toplam Ücret: <b>${toplamUcretStr}</b>`;
        document.getElementById("resultRow").style.display = "block";
        this.textContent = "Sipariş Ver";
        calcBtnState = "siparisver";
      } else if (calcBtnState === "siparisver") {
        if (!isLoggedIn()) {
          alert("Lütfen giriş yapın veya kayıt olun.");
          return;
        }
        // Bilgileri localStorage ile taşı
        localStorage.setItem("sonSiparisHesaplama", JSON.stringify(hesaplamaBilgisi));
        window.location.href = "siparisver.html";
      }
    };

    // Hesaplama inputları değiştiğinde resetle
    ["urunLink", "turkiyeFiyat", "kategori", "teslimatTipi", "sehir"].forEach(id => {
      document.getElementById(id).addEventListener("input", function(){
        document.getElementById("resultRow").style.display = "none";
        document.getElementById("calcBtn").textContent = "Ücreti Hesapla";
        calcBtnState = "hesapla";
      });
    });
  </script>
</body>
</html>
